{{- if .Capabilities.APIVersions.Has "vcenter-operator.stable.sap.cc/v1" }}
apiVersion: vcenter-operator.stable.sap.cc/v1
kind: VCenterTemplate
apiVersion: extensions/v1beta1
metadata:
  name: 'vcenter-datacenter-exporter-service'
  scope: 'datacenter'
  {% if ((vcenter_exporter is defined) and
          (vcenter_exporter['enabled'] == "true")) %}
  {% for exporter_type in vcenter_exporter['datacenter_exporter_types'] %}
template: |{{`
  ---
  kind: Service
  apiVersion: v1
  metadata:
    name: vcenter-exporter-{{ name }}-{{ exporter_type['name'] }}
    namespace: monsoon3
    labels:
      system: openstack
      service: metrics
      component: vcenter-exporter-{{ name }}-{{ exporter_type['name'] }}
  {% if exporter_type['collector'] is defined and exporter_type['collector'] != None %}
    annotations:
      maia.io/scrape: {% if 'maia' in exporter_type['collector'] %}"true"{% else %}"false"{% endif %}
      maia.io/port: "{{ vcenter_exporter['prometheus_port'] }}"
      prometheus.io/scrape: {% if 'prometheus' in exporter_type['collector'] %}"true"{% else %}"false"{% endif %}
      prometheus.io/port: "{{ vcenter_exporter['prometheus_port'] }}" {% endif %}
  spec:
    selector:
      component: vcenter-exporter-{{ name }}-{{ exporter_type['name'] }}
    ports:
      - name: metrics
        port: {{ vcenter_exporter['prometheus_port'] }}
  {% endfor %}
  {% endif %}
`}}
{{- end }}
